define("maths/Vector2",[],function(){function n(e,t){return this instanceof n?(this.x=void 0===e?0:e,void(this.y=void 0===t?0:t)):new n(e,t)}return n.fromPolar=function(e,t){t=void 0===t?1:t;var i=t*Math.cos(e),o=t*Math.sin(e);return n(i,o)},n.ZERO=function(){return n(0,0)},n.ONE=function(){return n(1,1)},n.UP=function(){return n(0,1)},n.DOWN=function(){return n(0,-1)},n.RIGHT=function(){return n(1,0)},n.LEFT=function(){return n(-1,0)},n.prototype={clone:function(){return n(this.x,this.y)},add:function(e){return n(this.x+e.x,this.y+e.y)},subtract:function(e){return n(this.x-e.x,this.y-e.y)},scale:function(e){return n(this.x*e,this.y*e)},dot:function(n){return this.x*n.x+this.y+n.y},moveTowards:function(n,e){e=Math.min(e,1);var t=n.subtract(this);return this.add(t.scale(e))},magnitude:function(){return Math.sqrt(this.magnitudeSqr())},magnitudeSqr:function(){return this.x*this.x+this.y*this.y},distance:function(n){return Math.sqrt(this.distanceSqr(n))},distanceSqr:function(n){var e=this.x-n.x,t=this.y-n.y;return e*e+t*t},normalize:function(){var e=this.magnitude();return Math.abs(e)<1e-9?n.ZERO():this.scale(1/e)},angle:function(){return Math.atan2(this.y,this.x)},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),o=this.x*t-this.y*i,r=this.x*i+this.y*t;return n(o,r)},round:function(e){e=void 0===e?0:e;var t=parseFloat(this.x.toFixed(e)),i=parseFloat(this.y.toFixed(e));return n(t,i)},toString:function(){var n=this.round(1);return"["+n.x+"; "+n.y+"]"}},n}),define("scene/Camera",["require","maths/Vector2"],function(n){function e(n){a=n,u=n}function t(n,e){u=u.moveTowards(e.position,c*n),s=u.subtract(a)}function i(n){var e=s.round();n.translate(-e.x,-e.y)}function o(n){var e=u.round();n.save(),n.strokeStyle="#0E0",n.strokeRect(e.x-10,e.y-10,20,20),n.restore()}var r=n("maths/Vector2"),a=r(),u=r(),s=r(),c=5.5;return{init:e,update:t,transformView:i,render:o,getShift:function(){return s.round()}}}),define("scene/Environment",["require","maths/Vector2","scene/Camera"],function(n){function e(n,e){u=e,a=n}function t(n){f.push(n)}function i(n){f.forEach(function(e){e.update(n)})}function o(n){n.save(),n.beginPath(),n.lineWidth=5,n.strokeStyle="#222",n.fillStyle="#fee",d.forEach(function(e){n.lineTo(e.x,e.y)}),n.closePath(),n.stroke(),n.fill(),n.restore()}function r(n){n.save();var e=c.getShift();n.fillStyle="#aaf",n.fillRect(e.x-5,e.y-5,a+10,u+10),n.restore(),o(n),f.forEach(function(e){e.render(n)})}var a,u,s=n("maths/Vector2"),c=n("scene/Camera"),f=[],d=[s(-50,200),s(500,-100),s(800,0),s(900,200),s(600,700),s(100,500)];return{init:e,registerGameObject:t,update:i,render:r}}),define("app/GameInput",["require","maths/Vector2","scene/Camera"],function(n){function e(n){m.push(n)}function t(n){l=n.offset(),l.left=Math.round(l.left),l.top=Math.round(l.top),$("#wrapper").mousemove(function(n){p.x=n.pageX-l.left,p.y=n.pageY-l.top}),r()}function i(n,e){var t;switch(n){case 32:t="SPACE";break;case 37:t="LEFT";break;case 38:t="UP";break;case 39:t="RIGHT";break;case 40:t="DOWN";break;default:t=String.fromCharCode(n)}d[t]=e}function o(n,e){1==n?h[0]=e:3==n&&(h[1]=e),m.forEach(function(t){t.notifyMouse(n,e)})}function r(){$(document).keydown(function(n){i(n.which,!0)}),$(document).keyup(function(n){i(n.which,!1)}),$(window).on("blur",function(){d={}}),$(document).mousedown(function(n){o(n.which,!0)}),$(document).mouseup(function(n){o(n.which,!1)}),$(document).contextmenu(function(){return!1})}function a(n){return n.match(/[a-zA-Z]/)?d[n.toLowerCase()]||d[n.toUpperCase()]:d[n]}function u(){return h}function s(n){return n=void 0===n?!0:n,n?p.add(f.getShift()):p}var c=n("maths/Vector2"),f=n("scene/Camera"),d={},h=[!1,!1],p=c(),l=null,m=[];return{init:t,isKeyDown:a,isMouseDown:u,getMouseCoords:s,registerObserver:e}}),define("scene/Bullet",["require","scene/Environment"],function(n){function e(n,e){this.position=n,this.direction=e,this.speed=400,this.spawned=!1}var t=n("scene/Environment");return e.prototype={spawn:function(){this.spawned||(t.registerGameObject(this),this.spawned=!0)},update:function(n){if(this.spawned){var e=this.direction.scale(n*this.speed);this.position=this.position.add(e)}},onCollision:function(n,e){},render:function(n){if(this.spawned){var e=this.position.round();n.save(),n.fillStyle="#222",n.beginPath(),n.arc(e.x,e.y,3,0,2*Math.PI),n.fill(),n.restore()}}},e}),define("scene/Gun",["require","maths/Vector2","app/GameInput","scene/Bullet"],function(n){function e(n){this.owner=n,this.gunTimer=0,this.TIME_BETWEEN_BULLETS=.2}var t=(n("maths/Vector2"),n("app/GameInput")),i=n("scene/Bullet");return e.prototype={update:function(n){this.gunTimer+=n,t.isMouseDown()[0]&&this.gunTimer>=this.TIME_BETWEEN_BULLETS&&(this.gunTimer=0,this.shoot())},shoot:function(){var n=new i(this.owner.position,this.getShootingDirection());n.spawn()},getShootingDirection:function(){var n=t.getMouseCoords(),e=n.subtract(this.owner.position);return e.normalize()},render:function(n,e){var t=this.owner.position.add(this.getShootingDirection().scale(e)).round();n.fillStyle="#900",n.fillRect(t.x-4,t.y-4,8,8)}},e}),define("scene/Player",["require","maths/Vector2","app/GameInput","scene/Gun"],function(n){function e(n){this.position=n,this.direction=t.RIGHT(),this.health=100,this.speed=180,this.turnSpeed=3.2,this.gun=new o(this),this.controls={up:["UP","W"],down:["DOWN","S"],left:["LEFT","A"],right:["RIGHT","D"]}}var t=n("maths/Vector2"),i=n("app/GameInput"),o=n("scene/Gun");return e.prototype={update:function(n){var e=this.direction.scale(this.getMovementDirection()*this.speed);this.position=this.position.add(e.scale(n)),this.direction=this.direction.rotate(this.getTurnAngle()*n),this.gun.update(n)},render:function(n){n.save();var e=this.position.round();n.fillStyle="#005",n.beginPath(),n.arc(e.x,e.y,10,0,2*Math.PI),n.fill();var t=this.position.add(this.direction.scale(14)).round();n.fillStyle="#000",n.beginPath(),n.arc(t.x,t.y,5,0,2*Math.PI),n.fill(),this.gun.render(n,14),n.restore()},getMovementDirection:function(){var n=t.ZERO();return this.controls.up.some(function(n){return i.isKeyDown(n)})&&(n=n.add(t.UP())),this.controls.down.some(function(n){return i.isKeyDown(n)})&&(n=n.add(t.DOWN())),n.y},getTurnAngle:function(){var n=0;return this.controls.right.some(function(n){return i.isKeyDown(n)})&&(n+=this.turnSpeed),this.controls.left.some(function(n){return i.isKeyDown(n)})&&(n-=this.turnSpeed),n}},e}),define("maths/Random",[],function(){var n={random:function(){return Math.random()},randomRange:function(n,e){return Math.random()*(e-n)+n},randomInt:function(n,e){return Math.floor(Math.random()*(e-n+1))+n},randomAngle:function(){return this.randomRange(0,2*Math.PI)}};return n}),define("scene/enemy/Enemy",[],function(){function n(n,e){this.position=n,this.direction=e,this.health=100,this.speed=50}return n.prototype={render:function(n){var e=this.position.round();n.save(),n.fillStyle="#A5A",n.beginPath(),n.arc(e.x,e.y,10,0,2*Math.PI),n.fill(),n.restore()},update:function(n){this.position=this.position.add(this.direction.scale(n*this.speed))}},n}),define("scene/enemy/EnemyManager",["require","maths/Vector2","maths/Random","scene/enemy/Enemy"],function(n){function e(n){u.forEach(function(e){var t=e.round();n.save(),n.strokeStyle="#E00",n.strokeRect(t.x-10,t.y-10,20,20),n.restore()}),s.forEach(function(e){e.render(n)})}function t(n){c+=n,c>=f&&(c-=f,i()),s.forEach(function(e){e.update(n)})}function i(){var n=r.randomInt(0,u.length-1),e=u[n],t=r.randomAngle(),i=new a(e.clone(),o.fromPolar(t,1));s.push(i)}var o=n("maths/Vector2"),r=n("maths/Random"),a=n("scene/enemy/Enemy"),u=[o(100,200),o(400,500),o(750,200)],s=[],c=0,f=1.5;return{render:e,update:t}}),define("app/Utils",[],function(){var n={getRequestAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}},drawMouseCoordinates:function(n,e,t){var i="w"+e.toString()+"; m"+t.toString();n.save(),n.font="12px sans",n.fillText(i,t.x+10,t.y),n.restore()}};return n}),define("app/GameManager",["require","scene/Camera","scene/Environment","scene/Player","scene/enemy/EnemyManager","app/GameInput","app/Utils","maths/Vector2"],function(n){function e(n){o=n.width,r=n.height,a=n.getContext("2d"),u=new f(l(120,200)),s.init(u.position.clone()),c.init(o,r)}function t(n){d.update(n),u.update(n),c.update(n),s.update(n,u)}function i(){a.clearRect(0,0,o,r),a.save(),a.save(),s.transformView(a),c.render(a),d.render(a),u.render(a),s.render(a),a.restore(),p.drawMouseCoordinates(a,h.getMouseCoords(),h.getMouseCoords(!1)),a.restore()}var o,r,a,u,s=n("scene/Camera"),c=n("scene/Environment"),f=n("scene/Player"),d=n("scene/enemy/EnemyManager"),h=n("app/GameInput"),p=n("app/Utils"),l=n("maths/Vector2");return{init:e,update:t,render:i}}),define("app/AssetLoader",[],function(){function n(n){c||a.push({f:n})}function e(n){s=n,h.css("width",n+"%")}function t(n){e(Math.min(90,s+n))}function i(n){h.html(n)}function o(){c=!0,e(100),i(""),setTimeout(function(){d.fadeOut(),f()},1e3)}function r(n){if(!c){f=n,d=$("#load-wrapper"),h=$("#load-progress"),d.fadeIn("slow"),u=a.length,e(10);var i=80/u;a.forEach(function(n){n.f(function(){u-=1,0>=u&&o()},function(n){t(i/n)})})}}var a=[],u=null,s=0,c=!1,f=null,d=null,h=null;return{addLoadFunction:n,init:r,isLoaded:function(){return c}}}),define("app/AudioManager",["require","app/AssetLoader"],function(n){function e(){s.addLoadFunction(i)}function t(){h=c.createBufferSource(),h.buffer=f[0],h.loop=!0,h.connect(v),v.connect(c.destination),p=c.createBufferSource(),p.buffer=f[1],p.connect(g),g.connect(c.destination)}function i(n,e){w=w(n,e),$.each(f,function(n,e){o(d+e,n)})}function o(n,e){var t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="arraybuffer",t.onload=function(){c.decodeAudioData(t.response,function(n){f[e]=n,w()},function(n){console.error("Audio data decoding error",n)})},t.send()}function r(){var n=c.currentTime;h.start(n+1)}function a(){h.stop()}function u(){p.start()}var s=n("app/AssetLoader"),c=new(window.AudioContext||window.webkitAudioContext),f=["ambient-menu.ogg","gunshot.wav"],d="audio/",h=null,p=null,l=.9,m=.7,g=c.createGain(),v=c.createGain();v.gain.value=m,g.gain.value=l;var w=function(n,e){function i(){r-=1,e(o),0>=r&&(t(),n())}var o=f.length,r=o;return i};return{init:e,playAmbient:r,stopAmbient:a,playGunshot:u}}),define("app/MainMenu",["require"],function(n){function e(n){o=$("#menu-wrapper");var e=$("#menu-play");e.click(function(){n()});var t=$("#menu-credits");t.click(function(){console.log("Swap menu screen here")});var i=$("#menu-leaderboard");i.click(function(){console.log("Swap menu screen here")})}function t(){o.fadeIn("slow")}function i(){o.fadeOut()}var o=null;return{init:e,show:t,hide:i}}),define("app/AppManager",["require","exports","module","app/GameManager","app/GameInput","app/AudioManager","app/AssetLoader","app/MainMenu","app/Utils"],function(n,e,t){function i(){var n=$("#canvas");s.init(n[0]),c.init(n),f.init(),d.init(function(){d.hide(),r()}),p=!0,r()}function o(){l=!1}function r(){p&&(l=!0,u=performance.now(),m(a))}function a(n){if(l){m(a);var e=(n-u)/1e3;u=n,s.update(e),s.render()}}var u,s=n("app/GameManager"),c=n("app/GameInput"),f=n("app/AudioManager"),d=(n("app/AssetLoader"),n("app/MainMenu")),h=n("app/Utils"),p=!1,l=!1,m=h.getRequestAnimationFrame();return $(window).on("load",i),{pause:o,resume:r,isRunning:function(){return l}}}),requirejs.config({baseUrl:"scripts/lib",paths:{app:"../core",maths:"../core/maths",scene:"../core/scene"}}),requirejs(["app/AppManager"]),define("../main",function(){});